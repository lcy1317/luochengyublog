---
title: DeFi Learning Advance
date: 2022-05-14 10:02:55
tags: Study
categories: DeFi
author: Lcy
comments: true
plugins: 
- mathjax
- katex
---

A reading note for 《How to DeFi Advance》
# Part One： State of DeFi

## 第一章 DeFi Snapshot

DeFi 是在2020年夏季开始崛起的。之后发展的就非常迅速了，那个夏天，DeFi协议的市值峰值增长了12倍。

2021年4月，DeFi的总锁定价值（TVL）突破了860.5亿美刀。

总之吧就是说了一下DeFi目前极受关注，有很大的发展前景。但他有一个地方错了，这本书说中国的对这种另类加密货币的看好，实际上，现在看来并不存在这种事情，封杀的挺彻底的。

## 第二章 DeFi Activities

介绍一些我们能够参与DeFi的方式。

### Yield Farming

Yield Farming指的是将资金分配给DeFi协议去获取收益。

一些Yield Farming的例子：

- 交易所Exchanges：为去中心化交易所做市提供资金，赚取交易手续费。
- 借钱Lending
- 保险Insurance：承保保险，赚取保费，同时承担灾害期间赔付的风险。
- 期权Options：通过卖出看涨和看跌期权来承销期权以赚取收益。
- 合成资产Synthetic Assets：铸造稳定币或其他合成资产，赚取费用作为回报。

### Liquidity Mining

流动性挖矿就是你提供一定你持有的加密货币为某个DeFi协议提供流动性支持以换取代币。

### Airdrops

空投，这应该经常听到了。就是免费发的代币，有时候空投就是一种营销策略。存在稀释代币所有权的风险 。如果当年参与了Uniswap的空投等于白赚一大笔。。。。

### Initial DEX Offerings (IDO)

加密项目必须在其代币发布和分发策略上具有创造性。随着去中心化交易所 (DEX)  的日益普及，项目现在有一个可行的选择，即无需支付高额费用即可在中心化交易所上市，直接面向用户。加密项目团队现在可以在不需要这些 DEX  许可的情况下列出他们的代币。

### Initial Bonding Curve Offering (IBCO)

初始债券曲线发行（IBCO）是一个相当新的概念，旨在防止抢先交易行为。本质上，随着越来越多的投资者提供资本进入联合曲线，代币价格将从其初始值增加。但是，您何时选择出资并不重要，因为所有投资者都将根据相同的最终结算价格进行支付。根据 IBCO  结束时的价格，每个投资者将根据他们在投资总资本中的份额获得一部分代币。

Example: Hegic & Aavegotchi

### Liquidity Bootstrapping Pool (LBP)

流动性引导池：项目使用可配置的自动做市出售代币的一种方式。通常，这些池将包含项目代币和抵押代币，通常以稳定币计价。智能池的控制器可以更改其参数并在销售中引入各种功能，例如随着时间的推移价格下降以及由于高需求或外部漏洞而暂停任何进一步的交换。

### Initial Farm Offering (IFO)

PancakeSwap 首次推出的初始农场产品 (IFO) 允许用户质押他们的流动性提供者 (LP)  代币以换取项目的代币。使用溢出机制，用户可以随心所欲地质押。在超额认购的情况下，任何多余的代币都将退还给投标人。 PancakeSwap 上的 IFO 使用  CAKE-BNB LP 代币，项目接收 BNB 代币以换取他们新铸造的协议代币，而剩余的 CAKE 代币被烧毁。

有用的链接：Yield Farming: https://zapper.fi/dashboard

### 风险

- 一个是注意APY是不是动态的，可能有的看起来很高但是随着参与人的增加会下降到一个很普通的值
- 一个是注意投资的风险 ，包括值不值得投资，毕竟项目太多了，可以投资的太多了，这个市场变化太快，你把握不住

# Part Two： Evaluation DeFi Sectors

## 第三章 去中心化的交易所

### DEX种类：

- 基于订单的DEX：感觉和股市挺像的。
- 基于流动性池的DEX：流动性池是位于  DEX 智能合约上的代币储备，可供用户交换代币。大多数基于流动性池的 DEX 都使用自动做市商 (AMM)，这是一种通过算法预先定义资产价格的数学函数。（这在之前的Beginner里面提到过AMM算法是怎么算的）

### AMM算法：

![image-20220425231949161](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220425231949161.png)

流动性池可以看成一个交易的代币池。AMM算法决定了交易的费率，而费率中的一部分就提供给了LP就是流动性提供者作为激励。

当前一些著名的AMM算法：

#### 恒乘积

$$
x*y = k
$$

Uniswap用的就是常数乘积。

#### 恒和

$$
x+y=k
$$

这个模型有缺陷，不能提供无限的流动性。

#### 恒定平均

$$
v = \Pi_tB_t^{w_t}
$$

恒定平均做市商公式，或也称为价值函数它允许流动性池具有两个以上的代币和超过标准 50/50  分配的不同代币比率。加权几何平均值保持不变，而不是乘积。这允许对池中不同资产的可变风险敞口，并允许在流动性池的任何资产之间进行互换。

#### 稳定交换不变量

$$
An^n\sum X_i+D=ADn^n+\frac{D^{n+1}}{n^n\Pi x_i}
$$

![image-20220425232558126](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220425232558126.png)

### 流动性池类型

- 公开池：任何人都可以添加流动性，但池参数是永久固定的。这是最trustless的池子。
- 私有池：灵活的参数。所有者是唯一可以更改参数并增加流动性的实体。这使得池托管和集中。
- 智能池：任何人都可以增加流动性。池支持固定和动态参数，可以持续更改。这是最灵活的池。

### AMM的风险

- 价格滑点：比如采用恒乘积的时候，交易的数额越大，就要产生更多的费用。
- Front-running：由于  AMM  上的订单被广播到区块链上供所有人查看，因此任何人都可以监控区块链以获取合适的订单并通过支付更高的交易费用来提前运行它，以使他们的订单比目标订单更快地被挖掘。进行这种无风险套利的领先者发起了一种被称为“三明治攻击”的攻击。

![image-20220425234523467](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220425234523467.png)

- 无常损失：流动性池子的流动性变化可能会导致你提供的流动性资产不如直接放在外面来的赚。

### Conclusion

DEX 在为 DeFi  空间提供动力方面发挥着至关重要的作用，因为它描述了当前的市场行为，尤其是加密货币的价格和流动性。它确定了各种加密货币相对于彼此的价值，并说明了交易和资本流动的动态性质。

## 第四章 DEX聚合器

之前说过DEX聚合器的作用，毕竟在AMM算法的加持下，比如说Uniswap的恒乘积策略下，当交易金额很高的时候对应的手续费也就越高。这显然对于哦我们交易者来说是不可接受的。所以就有了DEX聚合器就是DEX Aggregators。DEX聚合器能够将一笔较大的交易拆分，去不同的去中心化交易所交易，相当于综合了所有的去中心化交易所的流动性，而不用单纯的看一个交易所的流动性，大幅度降低了你作为一个用户来说在一家交易所交易大额所面临的高额手续费又或者减少了你自己去找哪里便宜这种麻烦事。

评价DEX聚合器的四个指标：

- 路由算法
- 流动性资源
- 当前的市场状态
- 交易规模

![image-20220426145303291](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220426145303291.png)

![image-20220426145317120](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220426145317120.png)

### 风险提示

咱就是说有时候DEX聚合器不一定靠谱，对于部分小的交易可能直接去DEX比较方便，成本也是更低的。

## 第五章 去中心化的借贷

比较著名的几个借贷协议：Compound、Maker、Avae、Cream

这些在beginner一书里面说过。

### 风险提示

注意智能合约漏洞等技术风险。

黑客可能会利用并耗尽这些协议上的抵押品。此外，许多借贷协议依赖价格预言机（第 12  章会详细介绍）来提供链上价格数据。价格预言可能会失败或被利用。 2020 年 11 月，Compound 的价格预言被利用，将 Coinbase Pro 上的  DAI 价格推高了 30%，导致价值 8900 万美元的贷款被清算。25  但是，作为借款人，主要风险包括因管理不善而失去抵押品抵押率。加密货币以其极端的价格波动而闻名，您的贷款可能会低于其最低抵押品比率并被清算。这不是一个理想的结果，因为您将承担相当大的损失并支付清算费用。因此，持续监控和维持健康的贷款抵押比率至关重要。

## 第六章 去中心化的稳定币和稳定资产

USDT就不用再介绍了，太常见了。Tether就是1美元换1USDT。

DAI也不用说了，是Maker发行的，现在稳如老狗。

### 算法稳定币

算法稳定币就是用算法来控制稳定币的市场结构和基础经济。大多数算法稳定币都与美元挂钩，有些是浮动挂钩，形成了算法稳定资产。与算法稳定币不同，算法稳定资产可以被视为另一种形式的抵押品。

![image-20220426155420044](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220426155420044.png)

### Rebase Model

变基模型通过改变稳定币的全部供应来控制价格。根据稳定币的价格是高于还是低于预期挂钩，协议将在固定期限内自动增加或减少每个持有者钱包中的供应量。这样做的原因是，通过强制控制供应，可以根据简单的通货膨胀/通货紧缩经济理论来影响稳定币的价格。该模型的开创性协议是 Ampleforth ——AMPL。

### Seigniorage Model铸币税模型

铸币税模型通过引入影响市场动态的奖励系统来控制价格。如果价格高于挂钩，则铸造新的代币并提供给提供流动性或持有代币的参与者。如果价格低于挂钩，则停止铸造代币，并引入机制以减少供应。用户可以购买优惠券来燃烧底层代币以将其从供应中移除。这些优惠券可能会在未来兑换更多代币，但前提是不亏。

三种基础的铸币税模型例子。

1. Empty Set Dollar（ESD）

2. Basis Cash

3. Frax Finance

可惜啊，梦想是美好的现实是骨感的。实际上的表现并不是那么尽如人意。这些币最终都跌的一塌糊涂，就UST、sUSD、FRAX最终还能保持和美元的挂钩。

### 风险提示

- 目前算法稳定币仍处于试验阶段
- 稳定币需要一个比较强大的社区
- 建议使用较多的时间来了解之后再考虑投资

## 第七章 去中心化衍生品

### 永续协议

永续协议是一种提供永续合约交易的去中心化协议，允许用户在各种加密资产上开立高达十倍的杠杆多头或空头头寸。为了实现这一点，Perpetual Protocol  使用了一种独特的虚拟自动做市商 (vAMM) 方法。功能类似于 Uniswap 和 Balancer 的 AMM，交易者可以直接通过 vAMM  执行交易。主要区别在于“虚拟”部分。在传统的  AMM 中，资产存储在智能合约中，每种资产的交易价格通过特定的数学函数确定。永续协议中的 vAMM 不存储任何资产。取而代之的是，实物资产存储在一个以 USDC  计价的智能合约保险库中，成为用户开设杠杆头寸的抵押品。保险库中的资金总额基本上构成了交易者利润的上限。每个永续合约都有自己特定的  vAMM，但它们都受到协议保险基金的保护。 Perpetual Protocol 能够通过使用 xDai 链进行交易执行来提供更高的交易速度和最少的 gas  交易。使用 vAMM，用户将能够获得高流动性和低滑点来满足他们的交易需求。

### 合成资产

合成资产是与另一种资产具有相同价值或效果的资产或资产组合。合成资产跟踪标的资产的价值，并允许在无需持有实际资产本身的情况下接触资产。

### 风险提示

- 注意杠杆，别玩火
- 可能缺乏流动性

## 第八章 去中心化的保险

保险基于两个假设运作：

1. 大数定律：保险承保的损失事件必须是独立的。如果事件足够频繁地重复，结果将收敛到预期值。
2. 风险池：损失事件具有频率低、影响大的特点。因此，一大群人支付的保险费补贴了几笔大额索赔的损失。

现在的DeFi行业，毕竟很多代码上的漏洞是很难发现的，所以保险怎么说呢，也算是一种比较必要的东西吧。

**三种保险协议**

### 1. Nexus Mutual

当前最大的保险协议。

提供两种保险：

1. 智能合约遭受攻击时的资金损失，比如遇到经济设计失败、严重的预言机失败、治理攻击等
2. 监护权保障，承担资金被黑客入侵或停止提款的风险。

代币：NXM

### 2. Armor Protocol

Armor 通过加密原生的动态智能覆盖聚合使对 DeFi 的投资尽可能安全。

提供的三种主要保险：

- arNXM
- arCore
- arNFT

### 3. Cover Protocol

Cover Protocol 由 Yearn Finance 孵化，最初是提供 yInsure 的 Safe Protocol。但由于创始人 Alan 和著名社区成员 Azeem Ahmed 之间的一些内讧，该项目被取消。 Azeem 接管了 yInsure 产品并发布了 Armor Protocol，而 Alan 继续发布 Cover Protocol。

![image-20220514095759994](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220514095759994.png)

### 相关风险

索赔赔付很大程度上取决于保险提供商和购买者之间的协议。在解释协议时总是存在细微差别，尤其是在涉及大额索赔的高风险场景。每个保险协议都会有自己的方式来决定支付什么，这可能不一定对所有买家都公平。购买者应了解保险产品提供的当前限制。作为保险协议的资金提供者是一项复杂的操作，用户在决定参与之前应该对风险有一个完整的了解。如果索赔的概率高于预期，Stakers 可能会蒙受损失。

# Part Four：Emerging DeFi Categories

## 第九章 去中心化指数

可以把去中心化指数看成ETF

### 指数协议：Index Cooperative

Index Coop 使用户能够广泛接触加密货币行业不同主题的不同协议。指数代币持有者可以拥有、接触并可以直接赎回构成指数的基础资产。

### 指数协议：Indexed Finance（NDX）

Indexed Finance 是一种专注于投资组合管理的协议。用户可以铸造、交换或销毁指数代币和基础资产，Balancer 分叉的集成自动做市商 (AMM) 机制会自动重新平衡其指数。

### 指数协议：PowerPool Concentrated Voting Power (CVP)

PowerPool 的指数是基于 Balancer 的自动做市商 (AMM) 的智能池，具有附加功能。其主要目的是将治理代币汇集在一起，用于借贷和执行元治理。此外，用户可以直接将一种治理代币换成另一种。

### 协议比较

协议费用：

![image-20220514102110851](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220514102110851.png)

基金权重：

![image-20220514102332048](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220514102332048.png)

一般有三种权重计算方式：

- Market Cap Weighted：该方法动态跟踪每项资产的市值，其中每项资产的分配与其相对于指数中其他资产的市值成正比。相对于较小的，使用这种方法的指数将集中在市值较大的代币上，从而使该指数能够密切模仿实际的市场表现。
- Square Root of Market Cap Weighted:Indexed Finance 上的所有指数均基于相对于每个标的资产的市值的平方根。这种方法抑制了市场表现倾向于更大市值硬币的影响。
- Equally-Weighted Market Cap Weighted:
- This method sets asset allocation equally. For example, there are 
  eight underlying assets in PIPT. Hence each of the assets is set to 
  12.5% weightage. An equal-weighted strategy is driven by price 
  momentum and would favor smaller market capitalization coins. 
  Smaller market capitalization coins are given the same importance 
  as large market capitalization coins. 

### 风险提示

1. 代码就是法律，防不住黑客，尽管代码确实都经过了审计
2. Mercenary Capital，大多数指数协议都有流动性挖掘计划，以激励流动性提供者并引导指数代币的流动性。然而，这些资本中的大部分通常被称为“雇佣资本”。这些资金纯粹是在寻求高回报，一旦出现另一个收益率更高的协议，就会退出。因此，一旦流动性挖矿奖励枯竭，可能会导致大量提款，从而导致指数协议呈螺旋式下降。
3. 系统性风险：在 DeFi 中，协议可以像金钱乐高一样堆叠在一起。然而，可组合性可能是一把双刃剑，因为它引入了系统性风险。例如，PowerPool 的 Yearn Lazy APE (YLA) 从其五个基础 Yearn 的稳定币保险库中有十种不同的风险敞口。

## 第十章 去中心化的预测市场


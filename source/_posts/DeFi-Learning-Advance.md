---
title: DeFi Learning Advance
date: 2022-05-14 10:02:55
tags: Study
categories: DeFi
author: Lcy
comments: true
plugins: 
- mathjax
- katex
---

A reading note for 《How to DeFi Advance》
# Part One： State of DeFi

## 第一章 DeFi Snapshot

DeFi 是在2020年夏季开始崛起的。之后发展的就非常迅速了，那个夏天，DeFi协议的市值峰值增长了12倍。

2021年4月，DeFi的总锁定价值（TVL）突破了860.5亿美刀。

总之吧就是说了一下DeFi目前极受关注，有很大的发展前景。但他有一个地方错了，这本书说中国的对这种另类加密货币的看好，实际上，现在看来并不存在这种事情，封杀的挺彻底的。

## 第二章 DeFi Activities

介绍一些我们能够参与DeFi的方式。

### Yield Farming

Yield Farming指的是将资金分配给DeFi协议去获取收益。

一些Yield Farming的例子：

- 交易所Exchanges：为去中心化交易所做市提供资金，赚取交易手续费。
- 借钱Lending
- 保险Insurance：承保保险，赚取保费，同时承担灾害期间赔付的风险。
- 期权Options：通过卖出看涨和看跌期权来承销期权以赚取收益。
- 合成资产Synthetic Assets：铸造稳定币或其他合成资产，赚取费用作为回报。

### Liquidity Mining

流动性挖矿就是你提供一定你持有的加密货币为某个DeFi协议提供流动性支持以换取代币。

### Airdrops

空投，这应该经常听到了。就是免费发的代币，有时候空投就是一种营销策略。存在稀释代币所有权的风险 。如果当年参与了Uniswap的空投等于白赚一大笔。。。。

### Initial DEX Offerings (IDO)

加密项目必须在其代币发布和分发策略上具有创造性。随着去中心化交易所 (DEX)  的日益普及，项目现在有一个可行的选择，即无需支付高额费用即可在中心化交易所上市，直接面向用户。加密项目团队现在可以在不需要这些 DEX  许可的情况下列出他们的代币。

### Initial Bonding Curve Offering (IBCO)

初始债券曲线发行（IBCO）是一个相当新的概念，旨在防止抢先交易行为。本质上，随着越来越多的投资者提供资本进入联合曲线，代币价格将从其初始值增加。但是，您何时选择出资并不重要，因为所有投资者都将根据相同的最终结算价格进行支付。根据 IBCO  结束时的价格，每个投资者将根据他们在投资总资本中的份额获得一部分代币。

Example: Hegic & Aavegotchi

### Liquidity Bootstrapping Pool (LBP)

流动性引导池：项目使用可配置的自动做市出售代币的一种方式。通常，这些池将包含项目代币和抵押代币，通常以稳定币计价。智能池的控制器可以更改其参数并在销售中引入各种功能，例如随着时间的推移价格下降以及由于高需求或外部漏洞而暂停任何进一步的交换。

### Initial Farm Offering (IFO)

PancakeSwap 首次推出的初始农场产品 (IFO) 允许用户质押他们的流动性提供者 (LP)  代币以换取项目的代币。使用溢出机制，用户可以随心所欲地质押。在超额认购的情况下，任何多余的代币都将退还给投标人。 PancakeSwap 上的 IFO 使用  CAKE-BNB LP 代币，项目接收 BNB 代币以换取他们新铸造的协议代币，而剩余的 CAKE 代币被烧毁。

有用的链接：Yield Farming: https://zapper.fi/dashboard

### 风险

- 一个是注意APY是不是动态的，可能有的看起来很高但是随着参与人的增加会下降到一个很普通的值
- 一个是注意投资的风险 ，包括值不值得投资，毕竟项目太多了，可以投资的太多了，这个市场变化太快，你把握不住

# Part Two： Evaluation DeFi Sectors

## 第三章 去中心化的交易所

### DEX种类：

- 基于订单的DEX：感觉和股市挺像的。
- 基于流动性池的DEX：流动性池是位于  DEX 智能合约上的代币储备，可供用户交换代币。大多数基于流动性池的 DEX 都使用自动做市商 (AMM)，这是一种通过算法预先定义资产价格的数学函数。（这在之前的Beginner里面提到过AMM算法是怎么算的）

### AMM算法：

![image-20220425231949161](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220425231949161.png)

流动性池可以看成一个交易的代币池。AMM算法决定了交易的费率，而费率中的一部分就提供给了LP就是流动性提供者作为激励。

当前一些著名的AMM算法：

#### 恒乘积

$$
x*y = k
$$

Uniswap用的就是常数乘积。

#### 恒和

$$
x+y=k
$$

这个模型有缺陷，不能提供无限的流动性。

#### 恒定平均

$$
v = \Pi_tB_t^{w_t}
$$

恒定平均做市商公式，或也称为价值函数它允许流动性池具有两个以上的代币和超过标准 50/50  分配的不同代币比率。加权几何平均值保持不变，而不是乘积。这允许对池中不同资产的可变风险敞口，并允许在流动性池的任何资产之间进行互换。

#### 稳定交换不变量

$$
An^n\sum X_i+D=ADn^n+\frac{D^{n+1}}{n^n\Pi x_i}
$$

![image-20220425232558126](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220425232558126.png)

### 流动性池类型

- 公开池：任何人都可以添加流动性，但池参数是永久固定的。这是最trustless的池子。
- 私有池：灵活的参数。所有者是唯一可以更改参数并增加流动性的实体。这使得池托管和集中。
- 智能池：任何人都可以增加流动性。池支持固定和动态参数，可以持续更改。这是最灵活的池。

### AMM的风险

- 价格滑点：比如采用恒乘积的时候，交易的数额越大，就要产生更多的费用。
- Front-running：由于  AMM  上的订单被广播到区块链上供所有人查看，因此任何人都可以监控区块链以获取合适的订单并通过支付更高的交易费用来提前运行它，以使他们的订单比目标订单更快地被挖掘。进行这种无风险套利的领先者发起了一种被称为“三明治攻击”的攻击。

![image-20220425234523467](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220425234523467.png)

- 无常损失：流动性池子的流动性变化可能会导致你提供的流动性资产不如直接放在外面来的赚。

### Conclusion

DEX 在为 DeFi  空间提供动力方面发挥着至关重要的作用，因为它描述了当前的市场行为，尤其是加密货币的价格和流动性。它确定了各种加密货币相对于彼此的价值，并说明了交易和资本流动的动态性质。

## 第四章 DEX聚合器

之前说过DEX聚合器的作用，毕竟在AMM算法的加持下，比如说Uniswap的恒乘积策略下，当交易金额很高的时候对应的手续费也就越高。这显然对于哦我们交易者来说是不可接受的。所以就有了DEX聚合器就是DEX Aggregators。DEX聚合器能够将一笔较大的交易拆分，去不同的去中心化交易所交易，相当于综合了所有的去中心化交易所的流动性，而不用单纯的看一个交易所的流动性，大幅度降低了你作为一个用户来说在一家交易所交易大额所面临的高额手续费又或者减少了你自己去找哪里便宜这种麻烦事。

评价DEX聚合器的四个指标：

- 路由算法
- 流动性资源
- 当前的市场状态
- 交易规模

![image-20220426145303291](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220426145303291.png)

![image-20220426145317120](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220426145317120.png)

### 风险提示

咱就是说有时候DEX聚合器不一定靠谱，对于部分小的交易可能直接去DEX比较方便，成本也是更低的。

## 第五章 去中心化的借贷

比较著名的几个借贷协议：Compound、Maker、Avae、Cream

这些在beginner一书里面说过。

### 风险提示

注意智能合约漏洞等技术风险。

黑客可能会利用并耗尽这些协议上的抵押品。此外，许多借贷协议依赖价格预言机（第 12  章会详细介绍）来提供链上价格数据。价格预言可能会失败或被利用。 2020 年 11 月，Compound 的价格预言被利用，将 Coinbase Pro 上的  DAI 价格推高了 30%，导致价值 8900 万美元的贷款被清算。25  但是，作为借款人，主要风险包括因管理不善而失去抵押品抵押率。加密货币以其极端的价格波动而闻名，您的贷款可能会低于其最低抵押品比率并被清算。这不是一个理想的结果，因为您将承担相当大的损失并支付清算费用。因此，持续监控和维持健康的贷款抵押比率至关重要。

## 第六章 去中心化的稳定币和稳定资产

USDT就不用再介绍了，太常见了。Tether就是1美元换1USDT。

DAI也不用说了，是Maker发行的，现在稳如老狗。

### 算法稳定币

算法稳定币就是用算法来控制稳定币的市场结构和基础经济。大多数算法稳定币都与美元挂钩，有些是浮动挂钩，形成了算法稳定资产。与算法稳定币不同，算法稳定资产可以被视为另一种形式的抵押品。

![image-20220426155420044](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220426155420044.png)

### Rebase Model

变基模型通过改变稳定币的全部供应来控制价格。根据稳定币的价格是高于还是低于预期挂钩，协议将在固定期限内自动增加或减少每个持有者钱包中的供应量。这样做的原因是，通过强制控制供应，可以根据简单的通货膨胀/通货紧缩经济理论来影响稳定币的价格。该模型的开创性协议是 Ampleforth ——AMPL。

### Seigniorage Model铸币税模型

铸币税模型通过引入影响市场动态的奖励系统来控制价格。如果价格高于挂钩，则铸造新的代币并提供给提供流动性或持有代币的参与者。如果价格低于挂钩，则停止铸造代币，并引入机制以减少供应。用户可以购买优惠券来燃烧底层代币以将其从供应中移除。这些优惠券可能会在未来兑换更多代币，但前提是不亏。

三种基础的铸币税模型例子。

1. Empty Set Dollar（ESD）

2. Basis Cash

3. Frax Finance

可惜啊，梦想是美好的现实是骨感的。实际上的表现并不是那么尽如人意。这些币最终都跌的一塌糊涂，就UST、sUSD、FRAX最终还能保持和美元的挂钩。

### 风险提示

- 目前算法稳定币仍处于试验阶段
- 稳定币需要一个比较强大的社区
- 建议使用较多的时间来了解之后再考虑投资

## 第七章 去中心化衍生品

### 永续协议

永续协议是一种提供永续合约交易的去中心化协议，允许用户在各种加密资产上开立高达十倍的杠杆多头或空头头寸。为了实现这一点，Perpetual Protocol  使用了一种独特的虚拟自动做市商 (vAMM) 方法。功能类似于 Uniswap 和 Balancer 的 AMM，交易者可以直接通过 vAMM  执行交易。主要区别在于“虚拟”部分。在传统的  AMM 中，资产存储在智能合约中，每种资产的交易价格通过特定的数学函数确定。永续协议中的 vAMM 不存储任何资产。取而代之的是，实物资产存储在一个以 USDC  计价的智能合约保险库中，成为用户开设杠杆头寸的抵押品。保险库中的资金总额基本上构成了交易者利润的上限。每个永续合约都有自己特定的  vAMM，但它们都受到协议保险基金的保护。 Perpetual Protocol 能够通过使用 xDai 链进行交易执行来提供更高的交易速度和最少的 gas  交易。使用 vAMM，用户将能够获得高流动性和低滑点来满足他们的交易需求。

### 合成资产

合成资产是与另一种资产具有相同价值或效果的资产或资产组合。合成资产跟踪标的资产的价值，并允许在无需持有实际资产本身的情况下接触资产。

### 风险提示

- 注意杠杆，别玩火
- 可能缺乏流动性

## 第八章 去中心化的保险

保险基于两个假设运作：

1. 大数定律：保险承保的损失事件必须是独立的。如果事件足够频繁地重复，结果将收敛到预期值。
2. 风险池：损失事件具有频率低、影响大的特点。因此，一大群人支付的保险费补贴了几笔大额索赔的损失。

现在的DeFi行业，毕竟很多代码上的漏洞是很难发现的，所以保险怎么说呢，也算是一种比较必要的东西吧。

**三种保险协议**

### 1. Nexus Mutual

当前最大的保险协议。

提供两种保险：

1. 智能合约遭受攻击时的资金损失，比如遇到经济设计失败、严重的预言机失败、治理攻击等
2. 监护权保障，承担资金被黑客入侵或停止提款的风险。

代币：NXM

### 2. Armor Protocol

Armor 通过加密原生的动态智能覆盖聚合使对 DeFi 的投资尽可能安全。

提供的三种主要保险：

- arNXM
- arCore
- arNFT

### 3. Cover Protocol

Cover Protocol 由 Yearn Finance 孵化，最初是提供 yInsure 的 Safe Protocol。但由于创始人 Alan 和著名社区成员 Azeem Ahmed 之间的一些内讧，该项目被取消。 Azeem 接管了 yInsure 产品并发布了 Armor Protocol，而 Alan 继续发布 Cover Protocol。

![image-20220514095759994](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220514095759994.png)

### 相关风险

索赔赔付很大程度上取决于保险提供商和购买者之间的协议。在解释协议时总是存在细微差别，尤其是在涉及大额索赔的高风险场景。每个保险协议都会有自己的方式来决定支付什么，这可能不一定对所有买家都公平。购买者应了解保险产品提供的当前限制。作为保险协议的资金提供者是一项复杂的操作，用户在决定参与之前应该对风险有一个完整的了解。如果索赔的概率高于预期，Stakers 可能会蒙受损失。

# Part Three：Emerging DeFi Categories

## 第九章 去中心化指数

可以把去中心化指数看成ETF

### 指数协议：Index Cooperative

Index Coop 使用户能够广泛接触加密货币行业不同主题的不同协议。指数代币持有者可以拥有、接触并可以直接赎回构成指数的基础资产。

### 指数协议：Indexed Finance（NDX）

Indexed Finance 是一种专注于投资组合管理的协议。用户可以铸造、交换或销毁指数代币和基础资产，Balancer 分叉的集成自动做市商 (AMM) 机制会自动重新平衡其指数。

### 指数协议：PowerPool Concentrated Voting Power (CVP)

PowerPool 的指数是基于 Balancer 的自动做市商 (AMM) 的智能池，具有附加功能。其主要目的是将治理代币汇集在一起，用于借贷和执行元治理。此外，用户可以直接将一种治理代币换成另一种。

### 协议比较

协议费用：

![image-20220514102110851](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220514102110851.png)

基金权重：

![image-20220514102332048](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220514102332048.png)

一般有三种权重计算方式：

- Market Cap Weighted：该方法动态跟踪每项资产的市值，其中每项资产的分配与其相对于指数中其他资产的市值成正比。相对于较小的，使用这种方法的指数将集中在市值较大的代币上，从而使该指数能够密切模仿实际的市场表现。
- Square Root of Market Cap Weighted:Indexed Finance 上的所有指数均基于相对于每个标的资产的市值的平方根。这种方法抑制了市场表现倾向于更大市值硬币的影响。
- Equally-Weighted Market Cap Weighted:
- This method sets asset allocation equally. For example, there are 
  eight underlying assets in PIPT. Hence each of the assets is set to 
  12.5% weightage. An equal-weighted strategy is driven by price 
  momentum and would favor smaller market capitalization coins. 
  Smaller market capitalization coins are given the same importance 
  as large market capitalization coins. 

### 风险提示

1. 代码就是法律，防不住黑客，尽管代码确实都经过了审计
2. Mercenary Capital，大多数指数协议都有流动性挖掘计划，以激励流动性提供者并引导指数代币的流动性。然而，这些资本中的大部分通常被称为“雇佣资本”。这些资金纯粹是在寻求高回报，一旦出现另一个收益率更高的协议，就会退出。因此，一旦流动性挖矿奖励枯竭，可能会导致大量提款，从而导致指数协议呈螺旋式下降。
3. 系统性风险：在 DeFi 中，协议可以像金钱乐高一样堆叠在一起。然而，可组合性可能是一把双刃剑，因为它引入了系统性风险。例如，PowerPool 的 Yearn Lazy APE (YLA) 从其五个基础 Yearn 的稳定币保险库中有十种不同的风险敞口。

## 第十章 去中心化的预测市场

预测市场是为参与者对未来事件的结果进行投注而创建的市场。传统预测市场的一个很好的例子是体育博彩平台。去中心化预测市场利用区块链技术在几乎任何事物上创建预测市场。例如，可以根据比特币价格何时超过 100,000 美元或下一任美国总统是谁来制定预测市场。去中心化预测市场的支持者认为，中心化平台使用户处于不利地位。标准做法包括高额交易费用、延迟提款和冻结账户。此外，当今大多数传统博彩平台都专注于体育博彩，限制了公众可用的预测市场类型。去中心化预测市场协议旨在通过允许用户创建自己的市场来赋予用户权力。

Whatever就是 菠菜

### Augur

[Augur 在以太坊网络上运行，并使用决议模型，通过奖励和惩罚来激励用户准确报告信息。](https://augur.net/blog/prediction-markets)市场收盘后，它将进入市场创建者或其他人（取决于市场谁）的报告期指定为指定报告者的创建者）可以提供信息以验证结果。

### Omen

[Omen 是由 DXdao 开发并由 Gnosis 协议提供支持的预测协议 - 它在以太坊和 xDai 侧链上运行。]( https://omen.eth.link/)Gnosis 允许 Omen 用户使用他们的代币框架，这是一个基于事件的资产类别，包含预测市场的构建块.

### 区别 

Augur 通过创建一个激励和惩罚生态系统来规范报告信息的可靠性，从而解决了预言机问题。 Omen 将他们的报告需求外包给外部 DAO（使用与 Augur 方法类似的原则）。从这个意义上说，Augur 更加自给自足。

### 风险提示

预测市场最大的担忧是数据的可靠性。虽然有多种基于利润的激励措施可以最大限度地减少数据操纵，但非理性行为者可能会试图危及结果。此外，受挑战的结果可能会导致耗时且成本高昂的情况。

## 第十一章 去中心化的固定利率协议

固定利率协议：Fixed-Interest Rate Protocols（FIRPs）

1. 借贷
2. 收益聚合

### Yield

Yield 是一个去中心化借贷系统，它使用一种名为“fyTokens”的新型代币提供固定利率借贷和利率市场。当前迭代（版本 1）包括 DAI 稳定币的 fyToken。这种被称为“fyDai”的新型代币可以在 DAI 中实现完全抵押的固定利率借贷。

fyDai 代币是基于以太坊的代币 (ERC20)，可以在预定的到期日后兑换为 DAI。 fyDai 类似于零息票或贴现债券。要铸造或出售 fyDai，借款人必须提供目前遵循与 MakerDao 相同的抵押率（150%）的 ETH 抵押品。贷方购买 fyDai，其定价通常低于 DAI。贴现值与 1 DAI（到期值）之间的差额代表贷方的借贷利率或借款人的借贷利率。

### Saffron.Finance

Saffron Finance 是面向流动性提供者的去中心化收益聚合器，是最早使用基于批次的系统的协议之一。 批次是从流动性池中创建的部分，按风险、到期时间或其他可销售的特征进行划分不同的投资者。

### Horizon Finance

与传统的收益聚合器不同，Horizon 允许用户根据博弈论原则创建自己的市场。博弈论设想了一个只有理性参与者的环境。在这种假设情况下，买卖双方将根据可用信息做出最佳决策。

### 风险提示

最重要的风险之一是 FIRP 提供固定利率的能力。这些协议中的大多数都依赖于外部代理或其他用户积极参与协议来驱动市场功能。如果存在不活跃的社区或用户配置文件和流动性不成比例的数量（例如，Yield 的贷方多于借款人，或者 Saffron Finance 的 A 部分参与者多于 AA 部分），FIRP 可能无法支持其固定利息率。

## 第十二章 去中心化的收益聚合器

### Yearn Finance

Yearn Finance 旨在自动化借贷平台之间的资本转换，以寻找 DeFi 借贷平台提供的最佳收益。大多数 DeFi 借贷平台提供浮动利率而不是固定利率。随着这些协议之间的利率变化，资金会在 dYdX、Aave 和 Compound 之间自动转移。该服务包括主要的美元稳定币，如 DAI、USDT、USDC 和 TUSD。例如，如果用户将 DAI 存入 Yearn Finance，则用户将收到一个 yDAI 代币作为回报，这是一个产生收益的 DAI 代币。后来，Yearn Finance 与 Curve Finance 合作发布了一个名为 yUSD 的具有收益的美元代币池。 

### Alpha Finance

Alpha Finance 通过他们的第一个产品 Alpha Homora 引入了杠杆收益农业，允许用户使用借来的资金来增加他们在收益农业活动中的曝光率。从本质上讲，它既充当借贷协议又充当收益聚合协议。

### Badger Finance

Badger DAO 旨在创建一个 DeFi 产品生态系统，最终目标是将比特币带入以太坊。这是第一个选择将比特币作为主要储备资产而不是使用以太坊的 DeFi 项目。

### Harvest Finance

从 Yearn Finance 的分支开始，Harvest Finance 采用了快速推进策略。它一直在比其他收益聚合器协议更快地发布新策略，即使是那些被认为是高风险的协议

### 风险提示

由于收益聚合器从风险更高的协议中寻求高收益的性质，它们面临着很高的黑客风险。在四种协议中，只有 Badger DAO 尚未被黑客入侵（截至 2021 年 4 月）。与保险协议的整合仍然乏善可陈，这可能是进一步增长该行业锁定的总价值的最大瓶颈。随着更多保险协议的推出，未来我们可能会看到保险收益聚合器产品的推出。

# Part Four: Technology Underpinning DeFi

## 第十三章 预言机和数据聚合器

DeFi 由智能合约提供支持。产生输出所需的输入包括未存储在区块链上的真实数据，例如天气状况或交通信息。需要协议通过将链下数据中继到区块链上来弥合差距，以便智能合约与数据进行交互。

链下信息是 DeFi 不可或缺的一部分，应始终有效且准确。拥有虚假数据将完全歪曲特定项目并给 DeFi 带来重大问题。但是，我们如何确保所提供的数据始终准确且值得信赖？一些协议旨在通过在不被操纵或篡改的情况下将数据传输和广播到区块链上来实现这一点。这通常通过投票或共识机制完成，验证者同意最准确的数据。如果没有预言机或数据聚合器作为主要的“真相来源”，不良行为者可以利用虚假信息来利用毫无戒心的用户。

所以，需要想办法弥补区块链和现实之间的数据误差。

### Oracle Protocol：Chainlink

Chainlink 是用于构建去中心化预言机网络的框架和基础设施，可将任何区块链网络上的智能合约安全地连接到外部数据资源和链下计算。每个预言机网络都由独立且抗 Sybil 的节点运营商保护，这些节点运营商从众多链下数据提供者那里获取数据，将信息聚合成一个值，然后在链上交付以供智能合约执行。

### Oracle Protocol: Band Protocol

Band Protocol 是一个跨链预言机平台，将智能合约与外部数据和 API 连接起来。与 Band Protocol 集成的去中心化应用程序通过 Band Protocol 的智能合约数据点接收数据，而不是直接从链下预言机接收数据。



如果预言机将现实世界的数据连接到区块链，那么数据聚合器可以帮助用户读取它。这些协议将区块链数据编译为简化格式，使项目和个人用户更容易创建他们的分析仪表板。

### Data Aggregators: The Graph Protocol

The Graph 是一种去中心化协议，用于从以太坊、Polkadot 和 Solana 等区块链查询和接收数据。虽然通过读取区块链上的合约地址直接检索查询更简单，但具有更高特异性和粒度的数据更难找到。 Graph 通过将区块链数据索引到“子图”或可以使用标准 GraphQL API 查询的开放 API 来解决这个问题。

### Data Aggregators: Covalent 

Covalent 是一个区块链数据提供商，它提供了一个统一的 API 来访问看似无穷无尽的链上数据。可以使用单个 API 检索来自各种区块链的代币余额和钱包活动的详细信息，从而使开发人员更容易创建分析仪表板或收集有关区块链活动的见解。 

### 风险提示

随着越来越多的协议开始依赖在最恶劣环境中经过实战考验的长期产品，记住这些产品可能并非完全万无一失也很重要。如果发生黑天鹅事件，预言机可能无法有效地提供数据，从而导致做出不准确的决策。在 2020 年 3 月，也称为黑色星期四，Chainlink 和 MakerDAO 的“Medianizer”等预言机未能足够快地更新其价格信息，导致价格严重错误。 MakerDAO 的价格失败引发了一系列灾难性事件，导致 CDP 所有者损失了价值超过 800 万美元的 ETH 抵押品。

## 第十四章 多链和跨链协议

### Ren Project

Ren Project 是一个无需许可的协议，允许用户在区块链之间匿名交互和传输代币。 Ren 协议通过 Ren 虚拟机 (RenVM) 提供支持的 RenBridge 实现这一点。

### ThorChain

ThorChain 是一个去中心化的流动性网络，具有可互操作的区块链，允许以非托管方式进行跨链代币交换。它不固定或包装资产，但允许用户在各种第 1 层区块链之间交换代币。例如，ThorChain 上的交易者可以将他们的资产从比特币无缝转移到以太坊，而无需注册或通过中心化交易所的 KYC 流程。

### Binance Bridge

使用 Binance Bridge，用户可以在各种区块链之间转移资金，例如 Ethereum、Tron 或 Binance Smart Chain (BSC) 网络。每个特定资产仅支持特定的区块链。例如，Cosmos (ATOM) 和 Ontology (ONT) 等其他区块链的原生代币仅限于币安智能链、币安链或其原生网络之间的转账。每个区块链每天可以转账的数量有限制资产。

### Anyswap

Anyswap 是一个去中心化的跨链交易所，支持以太坊、币安智能链、Fantom 等八种不同的区块链。它为用户提供了一个多合一的平台，可以将他们的资产交换或转换到其他区块链上。用户可以选择将其资产存入铸币包装代币的传统方法，或直接执行跨链交换以将其代币换成不同区块链上的另一个代币。

### Terra Bridge

Terra Bridge 是一个应用程序，供用户将 Terra 区块链上支持的 Terra 资产发送到以太坊和币安智能链网络。这些资产包括 LUNA（Terra 的原生代币）、UST（Terra USD）等 Terra 稳定币，以及 mTSLA（Tesla）和 mAAPL（Apple Inc.）等镜像资产。

## 第十五章 DeFi Exploits

参与DeFi有风险，2020年的时候啊，就出现了12起黑客事件，总共损失了$121m。

DeFi 的最大风险在于，随着项目利用 DeFi 的可组合性并相互构建，DeFi 应用程序的复杂性呈指数级增长，这使得智能合约审计人员更难发现弱点。 DeFi 应用程序开发人员必须确保网络安全审计人员不断检查他们的代码，以减少任何被利用的可能性，因为错误的后果将是巨大的经济损失。

1. 经济漏洞/闪电贷款：只要借款人在同一笔交易中偿还贷款，闪电贷允许用户利用几乎无限的资金进行金融交易。它是一种强大的工具，可以让人们操纵过去受资本要求限制的经济攻击。对于闪电贷款，拥有正确的策略是利用机会的唯一要求。几乎所有的 DeFi 黑客都使用了闪电贷。
2. 项目审计：不是所有项目都负担的起审计，这就会给黑客可乘之机
3. 编码草率 审计不足：在牛市中，许多项目团队感到有压力快速行动并采取捷径更快地发布他们的产品。有些人可能会决定完全跳过审核以获得先发优势，并且仅在产品上线几个月后进行审核。还有很多“分叉”——使用与其他已建立项目相同的代码的新项目。在没有完全了解代码工作原理的情况下启动它们，它们被视为快速现金攫取，导致许多漏洞。
4. Rug Pull：在 DeFi 领域，由匿名团队发起的项目并不少见。有些人这样做是为了避免由于不确定的监管环境而受到监管机构的审查。这就导致如果遇到恶意的项目开发者你追溯不到
5. 预言机攻击：DeFi 协议需要知道资产价格才能正常运行。例如，借贷协议需要知道资产价格来决定是否清算借款人的头寸。因此，作为 DeFi 基础设施不可或缺的一部分，预言机可能会受到重度操纵。例如，我们在第 12 章中提到了 MakerDao 的金库被利用如何导致不必要的金库清算，造成总计超过 800 万美元的 ETH 损失。
6. Metamask攻击：就是攻击你的钱包，不过他们安全团队比较牛逼目前没有出事。

### 闪电贷款

闪贷是指用户可以在没有任何抵押品的情况下借入资金的贷款，只要用户在同一笔交易中偿还贷款。如果用户没有在同一笔交易中偿还闪贷，交易将自动失败，造成交易费用损失，并确保闪贷不会发生。闪贷由各种 DeFi 协议提供，例如 Aave和 dYdX。

闪电贷主要用于套利目的。套利是利用市场之间的价格差异来获利的行为。例如，假设我们在两个不同的去中心化交易所发现 WBTC 的价格差异很大。我们可以使用闪电贷在没有任何抵押品的情况下借入大量 WBTC，从而从差价中获利。

闪贷的第二种用途是清算贷款。如果借款人让协议清算他们的头寸，他们通常会受到惩罚。当市场价格波动较大时，借款人可以选择获得闪贷并自行平仓，避免罚款。让我们看一个例子，我们从 Maker 那里借用 DAI 并以 ETH 作为抵押品。当 ETH 的价格大幅下跌时，它可能会接近我们 DAI 贷款的清算水平。我们可能没有 ETH 来增加我们的抵押品，也没有 DAI 来偿还贷款。我们能做的就是通过 DAI 闪贷来偿还 Maker 贷款。然后，我们可以将部分提取的 ETH 抵押品换成 DAI，以立即偿还闪电贷。

### 闪贷协议：Furucombo

Furucombo是一个平台，允许任何人使用闪贷创建套利策略。由于其拖放工具使最终用户能够构建和自定义不同的 DeFi 组合，降低了组装货币乐高的门槛。请注意，Furucombo 不会为您找到套利机会。要使用 Furucombo，用户需要设置输入/输出和交易的顺序，它将所有立方体捆绑到一个交易中执行。

### 闪贷黑客案例： bZx

2020 年 2 月 15 日，以太坊区块链上发生了一笔交易。在不到一分钟的时间内，在一个区块和一次交易中实现了大约 360,000 美元的利润。

这笔交易引起了加密社区的关注并得到了广泛的分析。收益是通过以闪电贷形式进行的最初几乎无风险的贷款实现的，随后是不同去中心化交易所之间的一系列套利。

![image-20220514141112852](https://luochengyu.oss-cn-beijing.aliyuncs.com/img/image-20220514141112852.png)

1. 先从dYdX借了10000ETH闪贷
2. 将5500个质押在Compound来借了112WBTC
3. 1,300 ETH 存入 bZx 以使用 5 倍杠杆做空 ETH 支持 WBTC。从 bZx 借出的 5,637 ETH 用于使用 KyberSwap 兑换 51 BTC。根据 KyberSwap 算法，Uniswap 提供了最优惠的价格。然而，由于流动性低，掉期将 1 WBTC 的汇率推高至 109.8 WETH 左右，约为期间正常兑换率的三倍。
4. 攻击者在价格上涨后将借来的 112 WBTC 在 Uniswap 中出售，产生 6,871 ETH，兑换率为 1 WBTC = 61.2 WETH。
5. 攻击者用未使用的 3,200 ETH 和 6,871 ETH 出售，以 71 ETH 的利润偿还了 10,000 ETH 的闪电贷款

上述事件不仅证明了通过操纵其他资产的价格获得极端资本收益的可能性，而且除了相对较低的协议费用外，借款人也没有其他成本。借款人面临的唯一条件是贷款要在同一笔交易中偿还。因此，无抵押贷款的概念在该领域开辟了广泛的机会。

## 第十六章 金融未来

DeFi 的使命很明确：以更高的透明度、可访问性、效率、便利性和互操作性重塑传统金融的基础设施和界面。
